<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>中文厨房：把字句饺子工坊</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #ff6b6b;
            --secondary-color: #4ecdc4;
            --light-color: #f7fff7;
            --dark-color: #2d3047;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: var(--dark-color);
        }
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .dumpling-icon {
            font-size: 2.5rem;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .room-card, .ingredient-card, .question-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.08);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .room-card:hover, .ingredient-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0,0,0,0.12);
        }
        .ingredient-card {
            cursor: pointer;
            height: 100%;
        }
        .ingredient-card.selected {
            border: 3px solid var(--secondary-color);
            background-color: rgba(78, 205, 196, 0.05);
        }
        .ingredient-img {
            height: 100px;
            object-fit: contain;
            padding: 10px;
        }
        .view {
            display: none;
        }
        .view.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        .progress-bar {
            background-color: var(--secondary-color);
        }
        .student-list-item {
            border-left: 4px solid var(--primary-color);
            margin-bottom: 8px;
            padding: 10px 15px;
            background-color: white;
            border-radius: 0 8px 8px 0;
        }
        .score-badge {
            font-size: 1.2rem;
            padding: 8px 15px;
            border-radius: 50px;
        }
        .btn-custom {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 50px;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-custom:hover {
            background-color: #ff5252;
            transform: scale(1.05);
            color: white;
        }
        .btn-secondary-custom {
            background-color: var(--secondary-color);
            color: white;
            border: none;
        }
        .feedback-correct {
            color: #28a745;
            font-weight: bold;
            animation: pulse 1.5s infinite;
        }
        .feedback-incorrect {
            color: #dc3545;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        .teacher-panel {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.08);
            padding: 20px;
            margin-bottom: 20px;
        }
        .question-option {
            cursor: pointer;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            transition: all 0.2s;
        }
        .question-option:hover {
            background-color: #f8f9fa;
        }
        .question-option.selected {
            border-color: var(--secondary-color);
            background-color: rgba(78, 205, 196, 0.1);
        }
        .question-option.correct {
            border-color: #28a745;
            background-color: rgba(40, 167, 69, 0.1);
        }
        .question-option.incorrect {
            border-color: #dc3545;
            background-color: rgba(220, 53, 69, 0.1);
        }
        #studentProgressChart {
            max-height: 300px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <div class="d-flex align-items-center justify-content-between">
                <div class="d-flex align-items-center">
                    <i class="fas fa-dumpling-beam dumpling-icon me-3"></i>
                    <div>
                        <h1 class="h3 mb-1">中文厨房：把字句饺子工坊</h1>
                        <p class="mb-0">通过调配饺子馅学习位移"把"字句 • HSK 3-4级语法练习</p>
                    </div>
                </div>
                <div id="roomInfo" class="d-none">
                    <span class="badge bg-light text-dark fs-6 p-2">
                        <i class="fas fa-door-open me-1"></i>房间: <span id="currentRoomCode">---</span>
                        <span id="userRoleBadge" class="ms-2"></span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- 视图1: 首页/角色选择 -->
        <div id="viewHome" class="view active">
            <div class="row justify-content-center">
                <div class="col-lg-10 text-center">
                    <div class="p-5 bg-white rounded-3 shadow-sm mb-5">
                        <i class="fas fa-mortar-pestle display-1 text-warning mb-4"></i>
                        <h2 class="mb-3">欢迎来到饺子工坊</h2>
                        <p class="lead mb-4">这是一个专为HSK 3-4级学生设计的互动课堂。通过选择饺子原料并完成"把"字句练习，掌握表示位移的"把"字句用法[citation:7]。</p>
                        <p class="text-muted">请选择您的角色进入课堂：</p>
                        
                        <div class="row mt-5">
                            <div class="col-md-6 mb-4">
                                <div class="room-card p-4 h-100">
                                    <div class="d-flex flex-column align-items-center">
                                        <i class="fas fa-chalkboard-teacher display-3 text-primary mb-3"></i>
                                        <h3>教师端</h3>
                                        <p class="text-center">创建课堂房间，设置练习内容，实时监控所有学生的答题进度和得分情况。</p>
                                        <button id="btnTeacher" class="btn btn-custom mt-3">
                                            <i class="fas fa-plus-circle me-2"></i>创建新课堂
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6 mb-4">
                                <div class="room-card p-4 h-100">
                                    <div class="d-flex flex-column align-items-center">
                                        <i class="fas fa-user-graduate display-3 text-success mb-3"></i>
                                        <h3>学生端</h3>
                                        <p class="text-center">加入教师创建的课堂房间，选择饺子原料，完成"把"字句练习并获得实时反馈。</p>
                                        <button id="btnStudent" class="btn btn-secondary-custom mt-3">
                                            <i class="fas fa-sign-in-alt me-2"></i>加入课堂
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="d-flex">
                                <div class="me-3 text-primary">
                                    <i class="fas fa-2x fa-language"></i>
                                </div>
                                <div>
                                    <h5>聚焦"位移把字句"</h5>
                                    <p class="small text-muted mb-0">专门练习"把+宾语+动词+在/到/给+地点"句型[citation:7]</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex">
                                <div class="me-3 text-success">
                                    <i class="fas fa-2x fa-sync-alt"></i>
                                </div>
                                <div>
                                    <h5>实时同步</h5>
                                    <p class="small text-muted mb-0">教师可实时查看所有学生进度与得分[citation:9]</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="d-flex">
                                <div class="me-3 text-warning">
                                    <i class="fas fa-2x fa-utensils"></i>
                                </div>
                                <div>
                                    <h5>HSK 3-4级词汇</h5>
                                    <p class="small text-muted mb-0">所有原料词汇均来自HSK 3-4级考试范围</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图2: 教师端 - 创建房间 -->
        <div id="viewTeacherCreate" class="view">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="teacher-panel">
                        <h3 class="mb-4"><i class="fas fa-chalkboard-teacher text-primary me-2"></i>创建新课堂</h3>
                        
                        <div class="mb-4">
                            <label for="teacherName" class="form-label">您的姓名</label>
                            <input type="text" class="form-control form-control-lg" id="teacherName" placeholder="例如: 王老师">
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label">课堂难度设置</label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="difficulty" id="difficultyEasy" value="easy" checked>
                                <label class="form-check-label" for="difficultyEasy">
                                    <span class="badge bg-success me-2">初级</span> HSK 3级核心句型
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="difficulty" id="difficultyMedium" value="medium">
                                <label class="form-check-label" for="difficultyMedium">
                                    <span class="badge bg-warning me-2">中级</span> HSK 4级扩展句型
                                </label>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button id="btnCreateRoom" class="btn btn-custom btn-lg">
                                <i class="fas fa-door-open me-2"></i>创建课堂房间
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图3: 教师端 - 房间管理 -->
        <div id="viewTeacherRoom" class="view">
            <div class="row">
                <div class="col-lg-8">
                    <div class="teacher-panel">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <h3 class="mb-1"><i class="fas fa-door-open text-primary me-2"></i>课堂管理面板</h3>
                                <p class="text-muted mb-0">房间代码: <strong id="teacherRoomCode" class="fs-4">---</strong></p>
                            </div>
                            <div>
                                <button id="btnStartExercise" class="btn btn-success me-2">
                                    <i class="fas fa-play me-1"></i>开始练习
                                </button>
                                <button id="btnEndClass" class="btn btn-outline-danger">
                                    <i class="fas fa-stop me-1"></i>结束课堂
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert alert-info d-flex align-items-center">
                            <i class="fas fa-info-circle me-3 fs-4"></i>
                            <div>
                                请让学生访问此页面并输入房间代码 <strong id="roomCodeDisplay">---</strong> 加入课堂。
                                目前有 <span id="studentCount" class="badge bg-primary">0</span> 名学生在线。
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h5 class="mb-3"><i class="fas fa-users me-2"></i>学生列表</h5>
                                <div id="studentList" class="mb-4">
                                    <!-- 学生列表将在这里动态生成 -->
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-user-friends fa-2x mb-2"></i>
                                        <p>等待学生加入...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <h5 class="mb-3"><i class="fas fa-chart-bar me-2"></i>课堂统计</h5>
                                <div class="bg-light p-3 rounded-3">
                                    <div class="row text-center">
                                        <div class="col-6 mb-3">
                                            <div class="p-3 bg-white rounded-3">
                                                <div class="text-primary fs-4 fw-bold" id="statsAvgScore">0</div>
                                                <div class="text-muted small">平均得分</div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="p-3 bg-white rounded-3">
                                                <div class="text-success fs-4 fw-bold" id="statsCompleted">0</div>
                                                <div class="text-muted small">已完成</div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="p-3 bg-white rounded-3">
                                                <div class="text-warning fs-4 fw-bold" id="statsInProgress">0</div>
                                                <div class="text-muted small">进行中</div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <div class="p-3 bg-white rounded-3">
                                                <div class="text-info fs-4 fw-bold" id="statsNotStarted">0</div>
                                                <div class="text-muted small">未开始</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mt-4">
                                    <h6>进度图表</h6>
                                    <canvas id="studentProgressChart" height="150"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="teacher-panel">
                        <h5 class="mb-3"><i class="fas fa-clipboard-list me-2"></i>实时动态</h5>
                        <div id="activityFeed" class="activity-feed">
                            <div class="activity-item p-3 border-bottom">
                                <div class="small text-muted">刚刚</div>
                                <div>您创建了课堂房间</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="teacher-panel mt-4">
                        <h5 class="mb-3"><i class="fas fa-lightbulb me-2"></i>教学提示</h5>
                        <div class="alert alert-light">
                            <h6>位移"把"字句结构[citation:7]:</h6>
                            <p class="mb-1"><strong>把 + 宾语 + 动词 + 在/到/给 + 地点</strong></p>
                            <p class="small text-muted">例如: "我把饺子放在盘子里。"</p>
                            
                            <hr>
                            
                            <h6>常见学生错误:</h6>
                            <ul class="small text-muted mb-0">
                                <li>遗漏"把"字</li>
                                <li>动词后缺少方位词(在/到/给)</li>
                                <li>宾语位置错误</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图4: 学生端 - 加入房间 -->
        <div id="viewStudentJoin" class="view">
            <div class="row justify-content-center">
                <div class="col-lg-6">
                    <div class="room-card p-5">
                        <h3 class="mb-4 text-center"><i class="fas fa-sign-in-alt text-success me-2"></i>加入课堂</h3>
                        
                        <div class="mb-4">
                            <label for="studentName" class="form-label">你的姓名</label>
                            <input type="text" class="form-control form-control-lg" id="studentName" placeholder="例如: 小明">
                        </div>
                        
                        <div class="mb-4">
                            <label for="roomCodeInput" class="form-label">房间代码</label>
                            <input type="text" class="form-control form-control-lg" id="roomCodeInput" placeholder="请输入老师提供的4位代码">
                            <div class="form-text">请向你的老师获取房间代码</div>
                        </div>
                        
                        <div class="d-grid">
                            <button id="btnJoinRoom" class="btn btn-secondary-custom btn-lg">
                                <i class="fas fa-door-open me-2"></i>加入课堂
                            </button>
                        </div>
                        
                        <div class="text-center mt-4">
                            <a href="#" id="backToHomeFromJoin" class="text-decoration-none">
                                <i class="fas fa-arrow-left me-1"></i>返回首页
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图5: 学生端 - 选择原料 -->
        <div id="viewStudentIngredients" class="view">
            <div class="row">
                <div class="col-lg-8">
                    <div class="room-card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <h3 class="mb-1"><i class="fas fa-carrot text-warning me-2"></i>选择饺子原料</h3>
                                <p class="text-muted mb-0">请选择1-3种你想用来包饺子的原料(HSK 3-4级词汇)</p>
                            </div>
                            <div>
                                <span class="badge bg-light text-dark fs-6 p-2">
                                    已选: <span id="selectedCount">0</span>/3
                                </span>
                            </div>
                        </div>
                        
                        <div class="alert alert-light mb-4">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-info-circle text-info"></i>
                                </div>
                                <div>
                                    选择原料后，系统将根据你的选择生成相应的"把字句"练习题。
                                    所有词汇均来自HSK 3-4级考试范围[citation:8]。
                                </div>
                            </div>
                        </div>
                        
                        <div class="row" id="ingredientsContainer">
                            <!-- 原料卡片将通过JavaScript动态生成 -->
                        </div>
                        
                        <div class="d-flex justify-content-between mt-5 pt-4 border-top">
                            <button id="btnBackToRoom" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left me-1"></i>返回房间
                            </button>
                            <button id="btnProceedToExercise" class="btn btn-custom" disabled>
                                开始练习 <i class="fas fa-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="room-card p-4 mb-4">
                        <h5 class="mb-3"><i class="fas fa-shopping-basket me-2"></i>已选原料</h5>
                        <div id="selectedIngredientsList" class="mb-3">
                            <div class="text-center text-muted py-3">
                                <i class="fas fa-utensils fa-2x mb-2"></i>
                                <p>尚未选择任何原料</p>
                            </div>
                        </div>
                        
                        <div class="alert alert-light small">
                            <h6><i class="fas fa-lightbulb me-1"></i>提示:</h6>
                            <p class="mb-1">选择不同的原料会生成不同的"把字句"练习题。</p>
                            <p class="mb-0">例如: 选择"猪肉"和"白菜"会生成类似"把猪肉切碎"的句子。</p>
                        </div>
                    </div>
                    
                    <div class="room-card p-4">
                        <h5 class="mb-3"><i class="fas fa-language me-2"></i>把字句结构</h5>
                        <div class="p-3 bg-light rounded-3 mb-3">
                            <h6 class="text-primary">位移把字句[citation:7]:</h6>
                            <p class="mb-1"><strong>把 + 东西 + 动词 + 在/到/给 + 地方</strong></p>
                            <p class="small text-muted mb-0">例如: "我把饺子放在盘子里。"</p>
                        </div>
                        
                        <div class="p-3 bg-light rounded-3">
                            <h6 class="text-success">练习例句:</h6>
                            <ul class="small text-muted mb-0">
                                <li>请把盐<b>放到</b>桌子上。</li>
                                <li>他把白菜<b>切到</b>碗里。</li>
                                <li>我把饺子<b>放在</b>盘子里。</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图6: 学生端 - 把字句练习 -->
        <div id="viewStudentExercise" class="view">
            <div class="row">
                <div class="col-lg-8">
                    <div class="room-card p-4">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <h3 class="mb-1"><i class="fas fa-pencil-alt text-primary me-2"></i>把字句练习</h3>
                                <p class="text-muted mb-0">根据你选择的原料完成位移"把字句"</p>
                            </div>
                            <div class="text-end">
                                <div class="score-badge bg-primary text-white">
                                    得分: <span id="currentScore">0</span>/<span id="totalScore">0</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="progress mb-4" style="height: 8px;">
                            <div id="exerciseProgress" class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        
                        <div id="exerciseContainer">
                            <!-- 练习题将通过JavaScript动态生成 -->
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4 pt-4 border-top">
                            <button id="btnPrevQuestion" class="btn btn-outline-secondary d-none">
                                <i class="fas fa-arrow-left me-1"></i>上一题
                            </button>
                            <div>
                                <span id="questionCounter" class="text-muted me-3">题目 0/0</span>
                            </div>
                            <button id="btnNextQuestion" class="btn btn-custom">
                                下一题 <i class="fas fa-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="col-lg-4">
                    <div class="room-card p-4 mb-4">
                        <h5 class="mb-3"><i class="fas fa-clipboard-check me-2"></i>练习进度</h5>
                        <div class="mb-3">
                            <div class="d-flex justify-content-between mb-1">
                                <span>完成进度</span>
                                <span id="progressPercent">0%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div id="progressBar" class="progress-bar" role="progressbar" style="width: 0%"></div>
                            </div>
                        </div>
                        
                        <div id="ingredientReminder" class="p-3 bg-light rounded-3 mb-3">
                            <h6 class="text-warning">你的原料:</h6>
                            <div id="exerciseIngredients" class="small">
                                <!-- 已选原料将显示在这里 -->
                            </div>
                        </div>
                        
                        <div id="feedbackArea" class="mt-3">
                            <!-- 答题反馈将显示在这里 -->
                        </div>
                    </div>
                    
                    <div class="room-card p-4">
                        <h5 class="mb-3"><i class="fas fa-trophy me-2"></i>排行榜</h5>
                        <div id="leaderboard" class="mb-3">
                            <div class="text-center text-muted py-3">
                                <i class="fas fa-chart-line fa-2x mb-2"></i>
                                <p>等待其他同学完成练习...</p>
                            </div>
                        </div>
                        
                        <div class="alert alert-light small">
                            <h6><i class="fas fa-clock me-1"></i>实时同步:</h6>
                            <p class="mb-0">你的进度和得分会实时同步到教师端，老师可以看到全班的学习情况[citation:9]。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 视图7: 学生端 - 练习完成 -->
        <div id="viewStudentComplete" class="view">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="room-card p-5 text-center">
                        <div class="mb-4">
                            <i class="fas fa-award display-1 text-warning"></i>
                        </div>
                        
                        <h2 class="mb-3" id="completionTitle">练习完成!</h2>
                        
                        <div class="mb-4">
                            <div class="score-badge bg-success d-inline-block fs-2 px-4 py-3 mb-3">
                                最终得分: <span id="finalScore">0</span>/<span id="finalTotal">0</span>
                            </div>
                            <p class="lead" id="completionMessage">你成功完成了所有"把字句"练习!</p>
                        </div>
                        
                        <div class="row justify-content-center mb-4">
                            <div class="col-md-8">
                                <div class="p-4 bg-light rounded-3">
                                    <h5 class="mb-3">学习总结</h5>
                                    <div class="row text-center">
                                        <div class="col-6 mb-3">
                                            <div class="p-3 bg-white rounded-3">
                                                <div class="text-primary fs-4 fw-bold" id="summaryCorrect">0</div>
                                                <div class="text-muted small">正确题数</div>
                                            </div>
                                        </div>
                                        <div class="col-6 mb-3">
                                            <div class="p-3 bg-white rounded-3">
                                                <div class="text-warning fs-4 fw-bold" id="summaryTime">0</div>
                                                <div class="text-muted small">用时(秒)</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-center">
                            <button id="btnReviewExercise" class="btn btn-outline-primary me-3">
                                <i class="fas fa-redo me-1"></i>复习错题
                            </button>
                            <button id="btnNewIngredients" class="btn btn-custom">
                                <i class="fas fa-carrot me-1"></i>选择新原料
                            </button>
                        </div>
                        
                        <div class="mt-5 pt-4 border-top">
                            <p class="text-muted">你的学习数据已同步给老师。可以继续练习或等待老师的下一步指示。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 底部信息 -->
    <footer class="mt-5 py-4 bg-light border-top">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5 class="mb-3">中文厨房: 把字句饺子工坊</h5>
                    <p class="small text-muted">专为HSK 3-4级留学生设计的交互式语法练习平台。通过游戏化的饺子馅调配活动，掌握表示位移的"把字句"用法[citation:7]。</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small text-muted mb-0">语法重点: 把 + 宾语 + 动词 + 在/到/给 + 地点</p>
                    <p class="small text-muted mb-0">词汇范围: HSK 3-4级烹饪相关词汇[citation:8]</p>
                    <p class="small text-muted">教学建议: 配合实物演示效果更佳</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- 脚本依赖 -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- 注意: 实际部署时需要替换为真实的WebSocket服务器地址 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
    
    <script>
        // 应用状态管理
        const AppState = {
            currentView: 'home',
            userRole: null,
            userName: '',
            roomCode: '',
            socket: null,
            isConnected: false,
            
            // 教师端状态
            teacherState: {
                students: [],
                exerciseStarted: false,
                classActive: true
            },
            
            // 学生端状态
            studentState: {
                selectedIngredients: [],
                currentExercise: null,
                currentQuestionIndex: 0,
                answers: {},
                score: 0,
                startTime: null,
                completed: false
            },
            
            // 可用原料 (HSK 3-4级词汇)[citation:3][citation:8]
            ingredients: [
                { id: 1, name: '猪肉', pinyin: 'zhū ròu', category: '肉类', hskLevel: 3 },
                { id: 2, name: '白菜', pinyin: 'bái cài', category: '蔬菜', hskLevel: 3 },
                { id: 3, name: '盐', pinyin: 'yán', category: '调味品', hskLevel: 3 },
                { id: 4, name: '鸡蛋', pinyin: 'jī dàn', category: '蛋类', hskLevel: 3 },
                { id: 5, name: '面条', pinyin: 'miàn tiáo', category: '面食', hskLevel: 3 },
                { id: 6, name: '酱油', pinyin: 'jiàng yóu', category: '调味品', hskLevel: 4 },
                { id: 7, name: '醋', pinyin: 'cù', category: '调味品', hskLevel: 4 },
                { id: 8, name: '辣椒', pinyin: 'là jiāo', category: '蔬菜', hskLevel: 4 },
                { id: 9, name: '米饭', pinyin: 'mǐ fàn', category: '主食', hskLevel: 3 },
                { id: 10, name: '饺子', pinyin: 'jiǎo zi', category: '面食', hskLevel: 4 }
            ],
            
            // 把字句练习题模板
            exerciseTemplates: [
                {
                    id: 1,
                    pattern: "把 + [原料] + 放 + 在 + [地方]",
                    description: "将原料放置在某个地方",
                    questions: [
                        {
                            text: "请把__放到桌子上。",
                            options: ["白菜", "猪肉", "鸡蛋", "盐"],
                            correct: 0,
                            hint: "这是绿色的蔬菜"
                        },
                        {
                            text: "妈妈把__放在冰箱里。",
                            options: ["猪肉", "面条", "米饭", "饺子"],
                            correct: 3,
                            hint: "这是中国传统食物"
                        }
                    ]
                },
                {
                    id: 2,
                    pattern: "把 + [原料] + 切 + 到 + [容器]",
                    description: "将原料切到容器里",
                    questions: [
                        {
                            text: "他把__切到碗里。",
                            options: ["白菜", "辣椒", "鸡蛋", "猪肉"],
                            correct: 0,
                            hint: "这是包饺子常用的蔬菜"
                        },
                        {
                            text: "请把__切到盘子里。",
                            options: ["猪肉", "面条", "米饭", "鸡蛋"],
                            correct: 0,
                            hint: "这是肉类"
                        }
                    ]
                },
                {
                    id: 3,
                    pattern: "把 + [调味品] + 加 + 给 + [食物]",
                    description: "给食物添加调味品",
                    questions: [
                        {
                            text: "我把__加到饺子里。",
                            options: ["盐", "酱油", "醋", "辣椒"],
                            correct: 0,
                            hint: "这是最基本的调味品"
                        },
                        {
                            text: "他喜欢把__给面条。",
                            options: ["醋", "辣椒", "酱油", "盐"],
                            correct: 1,
                            hint: "这是辣的调味品"
                        }
                    ]
                }
            ],
            
            // 初始化方法
            init: function() {
                this.bindEvents();
                this.initSocket();
                this.renderIngredients();
                this.showView('home');
            },
            
            // 绑定事件
            bindEvents: function() {
                // 首页按钮
                document.getElementById('btnTeacher').addEventListener('click', () => this.showView('teacherCreate'));
                document.getElementById('btnStudent').addEventListener('click', () => this.showView('studentJoin'));
                
                // 教师端
                document.getElementById('btnCreateRoom').addEventListener('click', () => this.createRoom());
                document.getElementById('btnStartExercise').addEventListener('click', () => this.startExercise());
                document.getElementById('btnEndClass').addEventListener('click', () => this.endClass());
                
                // 学生端
                document.getElementById('btnJoinRoom').addEventListener('click', () => this.joinRoom());
                document.getElementById('backToHomeFromJoin').addEventListener('click', (e) => {
                    e.preventDefault();
                    this.showView('home');
                });
                document.getElementById('btnProceedToExercise').addEventListener('click', () => this.startStudentExercise());
                document.getElementById('btnBackToRoom').addEventListener('click', () => this.showView('studentIngredients'));
                document.getElementById('btnNextQuestion').addEventListener('click', () => this.nextQuestion());
                document.getElementById('btnPrevQuestion').addEventListener('click', () => this.prevQuestion());
                document.getElementById('btnReviewExercise').addEventListener('click', () => this.reviewExercise());
                document.getElementById('btnNewIngredients').addEventListener('click', () => this.newIngredients());
            },
            
            // 初始化WebSocket连接[citation:1]
            initSocket: function() {
                // 实际部署时需要替换为真实的WebSocket服务器地址
                // this.socket = io('https://your-websocket-server.com');
                
                // 由于演示目的，我们模拟WebSocket行为
                console.log('WebSocket初始化 (实际部署时需要真实服务器)');
                this.isConnected = true;
                
                // 模拟连接成功
                setTimeout(() => {
                    this.addActivity('系统', '模拟WebSocket连接已建立', '刚刚');
                }, 1000);
            },
            
            // 显示不同视图
            showView: function(viewId) {
                // 隐藏所有视图
                document.querySelectorAll('.view').forEach(view => {
                    view.classList.remove('active');
                });
                
                // 显示目标视图
                document.getElementById(`view${viewId.charAt(0).toUpperCase() + viewId.slice(1)}`).classList.add('active');
                this.currentView = viewId;
                
                // 更新房间信息显示
                if (this.roomCode && (viewId !== 'home' && viewId !== 'teacherCreate' && viewId !== 'studentJoin')) {
                    document.getElementById('roomInfo').classList.remove('d-none');
                    document.getElementById('currentRoomCode').textContent = this.roomCode;
                    
                    if (this.userRole === 'teacher') {
                        document.getElementById('userRoleBadge').innerHTML = '<span class="badge bg-primary">教师</span>';
                    } else if (this.userRole === 'student') {
                        document.getElementById('userRoleBadge').innerHTML = '<span class="badge bg-success">学生</span>';
                    }
                } else {
                    document.getElementById('roomInfo').classList.add('d-none');
                }
                
                // 视图特定的初始化
                switch(viewId) {
                    case 'teacherRoom':
                        this.initTeacherRoom();
                        break;
                    case 'studentIngredients':
                        this.updateSelectedIngredients();
                        break;
                    case 'studentExercise':
                        this.initExercise();
                        break;
                }
            },
            
            // 创建房间 (教师)
            createRoom: function() {
                const teacherName = document.getElementById('teacherName').value.trim();
                const difficulty = document.querySelector('input[name="difficulty"]:checked').value;
                
                if (!teacherName) {
                    alert('请输入您的姓名');
                    return;
                }
                
                this.userName = teacherName;
                this.userRole = 'teacher';
                
                // 生成4位随机房间代码
                this.roomCode = Math.floor(1000 + Math.random() * 9000).toString();
                
                // 更新UI
                document.getElementById('teacherRoomCode').textContent = this.roomCode;
                document.getElementById('roomCodeDisplay').textContent = this.roomCode;
                
                // 模拟发送到服务器
                this.sendToServer('createRoom', {
                    roomCode: this.roomCode,
                    teacherName: teacherName,
                    difficulty: difficulty
                });
                
                // 添加活动记录
                this.addActivity('系统', `${teacherName} 创建了房间 ${this.roomCode}`, '刚刚');
                
                // 切换到房间管理视图
                this.showView('teacherRoom');
            },
            
            // 初始化教师房间
            initTeacherRoom: function() {
                // 初始化图表
                this.initProgressChart();
                
                // 模拟学生加入 (演示用)
                setTimeout(() => {
                    this.addStudentToClass('李明', 'student1');
                    this.addStudentToClass('安娜', 'student2');
                    this.addStudentToClass('田中', 'student3');
                }, 1500);
            },
            
            // 初始化进度图表
            initProgressChart: function() {
                const ctx = document.getElementById('studentProgressChart').getContext('2d');
                
                // 演示数据
                const chartData = {
                    labels: ['未开始', '进行中', '已完成'],
                    datasets: [{
                        data: [3, 0, 0],
                        backgroundColor: [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)'
                        ],
                        borderColor: [
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)'
                        ],
                        borderWidth: 1
                    }]
                };
                
                new Chart(ctx, {
                    type: 'doughnut',
                    data: chartData,
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            },
            
            // 添加学生到班级
            addStudentToClass: function(studentName, studentId) {
                const student = {
                    id: studentId,
                    name: studentName,
                    status: 'not_started',
                    score: 0,
                    progress: 0
                };
                
                this.teacherState.students.push(student);
                this.updateStudentList();
                this.updateStats();
                
                // 添加活动记录
                this.addActivity('系统', `${studentName} 加入了课堂`, '刚刚');
            },
            
            // 更新学生列表
            updateStudentList: function() {
                const container = document.getElementById('studentList');
                const studentCount = document.getElementById('studentCount');
                
                studentCount.textContent = this.teacherState.students.length;
                
                if (this.teacherState.students.length === 0) {
                    container.innerHTML = `
                        <div class="text-center text-muted py-4">
                            <i class="fas fa-user-friends fa-2x mb-2"></i>
                            <p>等待学生加入...</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                this.teacherState.students.forEach(student => {
                    let statusBadge = '';
                    let progressColor = 'secondary';
                    
                    switch(student.status) {
                        case 'not_started':
                            statusBadge = '<span class="badge bg-secondary">未开始</span>';
                            progressColor = 'secondary';
                            break;
                        case 'in_progress':
                            statusBadge = '<span class="badge bg-warning">进行中</span>';
                            progressColor = 'warning';
                            break;
                        case 'completed':
                            statusBadge = '<span class="badge bg-success">已完成</span>';
                            progressColor = 'success';
                            break;
                    }
                    
                    html += `
                        <div class="student-list-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="fas fa-user-graduate me-2"></i>
                                    <strong>${student.name}</strong>
                                    ${statusBadge}
                                </div>
                                <div>
                                    <span class="me-3">得分: <strong>${student.score}</strong></span>
                                    <div class="progress" style="width: 100px; height: 8px; display: inline-block;">
                                        <div class="progress-bar bg-${progressColor}" role="progressbar" style="width: ${student.progress}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            },
            
            // 更新统计数据
            updateStats: function() {
                const students = this.teacherState.students;
                
                if (students.length === 0) {
                    document.getElementById('statsAvgScore').textContent = '0';
                    document.getElementById('statsCompleted').textContent = '0';
                    document.getElementById('statsInProgress').textContent = '0';
                    document.getElementById('statsNotStarted').textContent = '0';
                    return;
                }
                
                const completed = students.filter(s => s.status === 'completed').length;
                const inProgress = students.filter(s => s.status === 'in_progress').length;
                const notStarted = students.filter(s => s.status === 'not_started').length;
                const avgScore = students.length > 0 ? 
                    Math.round(students.reduce((sum, s) => sum + s.score, 0) / students.length) : 0;
                
                document.getElementById('statsAvgScore').textContent = avgScore;
                document.getElementById('statsCompleted').textContent = completed;
                document.getElementById('statsInProgress').textContent = inProgress;
                document.getElementById('statsNotStarted').textContent = notStarted;
            },
            
            // 添加活动记录
            addActivity: function(author, action, time) {
                const container = document.getElementById('activityFeed');
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item p-3 border-bottom';
                activityItem.innerHTML = `
                    <div class="small text-muted">${time}</div>
                    <div><strong>${author}</strong> ${action}</div>
                `;
                
                container.insertBefore(activityItem, container.firstChild);
                
                // 限制最多显示10条记录
                if (container.children.length > 10) {
                    container.removeChild(container.lastChild);
                }
            },
            
            // 开始练习 (教师)
            startExercise: function() {
                this.teacherState.exerciseStarted = true;
                
                // 模拟通知所有学生
                this.sendToServer('startExercise', { roomCode: this.roomCode });
                
                // 更新学生状态
                this.teacherState.students.forEach(student => {
                    student.status = 'in_progress';
                });
                
                this.updateStudentList();
                this.updateStats();
                
                // 添加活动记录
                this.addActivity('系统', '课堂练习已开始', '刚刚');
                
                alert('练习已开始，学生可以开始选择原料并答题。');
            },
            
            // 结束课堂
            endClass: function() {
                if (confirm('确定要结束课堂吗？所有学生将被断开连接。')) {
                    this.teacherState.classActive = false;
                    
                    // 模拟通知服务器
                    this.sendToServer('endClass', { roomCode: this.roomCode });
                    
                    // 添加活动记录
                    this.addActivity('系统', '课堂已结束', '刚刚');
                    
                    alert('课堂已结束。');
                    this.showView('home');
                }
            },
            
            // 加入房间 (学生)
            joinRoom: function() {
                const studentName = document.getElementById('studentName').value.trim();
                const roomCode = document.getElementById('roomCodeInput').value.trim();
                
                if (!studentName) {
                    alert('请输入你的姓名');
                    return;
                }
                
                if (!roomCode || roomCode.length !== 4) {
                    alert('请输入有效的4位房间代码');
                    return;
                }
                
                this.userName = studentName;
                this.userRole = 'student';
                this.roomCode = roomCode;
                
                // 模拟发送到服务器
                this.sendToServer('joinRoom', {
                    roomCode: roomCode,
                    studentName: studentName,
                    studentId: 'student_' + Date.now()
                });
                
                // 切换到原料选择视图
                this.showView('studentIngredients');
                
                // 模拟接收欢迎消息
                setTimeout(() => {
                    this.showFeedback('success', `欢迎 ${studentName}！请选择1-3种饺子原料开始练习。`);
                }, 500);
            },
            
            // 渲染原料卡片
            renderIngredients: function() {
                const container = document.getElementById('ingredientsContainer');
                let html = '';
                
                this.ingredients.forEach(ingredient => {
                    const hskBadge = ingredient.hskLevel === 3 ? 
                        '<span class="badge bg-success me-1">HSK3</span>' : 
                        '<span class="badge bg-warning me-1">HSK4</span>';
                    
                    html += `
                        <div class="col-md-4 col-sm-6 mb-3">
                            <div class="ingredient-card p-3" data-id="${ingredient.id}">
                                <div class="text-center mb-3">
                                    <i class="fas fa-utensils fa-2x text-warning"></i>
                                </div>
                                <h5 class="text-center mb-2">${ingredient.name}</h5>
                                <div class="text-center mb-2">
                                    <span class="text-muted small">${ingredient.pinyin}</span>
                                </div>
                                <div class="text-center mb-3">
                                    ${hskBadge}
                                    <span class="badge bg-light text-dark">${ingredient.category}</span>
                                </div>
                                <div class="text-center">
                                    <button class="btn btn-sm btn-outline-primary select-ingredient-btn">
                                        <i class="fas fa-plus me-1"></i>选择
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
                
                // 绑定选择事件
                document.querySelectorAll('.select-ingredient-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const card = e.target.closest('.ingredient-card');
                        const ingredientId = parseInt(card.getAttribute('data-id'));
                        this.toggleIngredient(ingredientId);
                    });
                });
                
                // 绑定卡片点击事件
                document.querySelectorAll('.ingredient-card').forEach(card => {
                    card.addEventListener('click', (e) => {
                        if (!e.target.classList.contains('select-ingredient-btn')) {
                            const ingredientId = parseInt(card.getAttribute('data-id'));
                            this.toggleIngredient(ingredientId);
                        }
                    });
                });
            },
            
            // 切换原料选择
            toggleIngredient: function(ingredientId) {
                const index = this.studentState.selectedIngredients.indexOf(ingredientId);
                const card = document.querySelector(`.ingredient-card[data-id="${ingredientId}"]`);
                
                if (index === -1) {
                    // 选择原料
                    if (this.studentState.selectedIngredients.length >= 3) {
                        alert('最多只能选择3种原料');
                        return;
                    }
                    
                    this.studentState.selectedIngredients.push(ingredientId);
                    card.classList.add('selected');
                } else {
                    // 取消选择
                    this.studentState.selectedIngredients.splice(index, 1);
                    card.classList.remove('selected');
                }
                
                // 更新UI
                this.updateSelectedIngredients();
                
                // 更新按钮状态
                const proceedBtn = document.getElementById('btnProceedToExercise');
                proceedBtn.disabled = this.studentState.selectedIngredients.length === 0;
            },
            
            // 更新已选原料列表
            updateSelectedIngredients: function() {
                const countElement = document.getElementById('selectedCount');
                const listElement = document.getElementById('selectedIngredientsList');
                
                countElement.textContent = this.studentState.selectedIngredients.length;
                
                if (this.studentState.selectedIngredients.length === 0) {
                    listElement.innerHTML = `
                        <div class="text-center text-muted py-3">
                            <i class="fas fa-utensils fa-2x mb-2"></i>
                            <p>尚未选择任何原料</p>
                        </div>
                    `;
                    return;
                }
                
                let html = '';
                this.studentState.selectedIngredients.forEach(id => {
                    const ingredient = this.ingredients.find(i => i.id === id);
                    if (ingredient) {
                        html += `
                            <div class="d-flex align-items-center p-2 mb-2 bg-light rounded">
                                <div class="me-3">
                                    <i class="fas fa-utensil-spoon text-warning"></i>
                                </div>
                                <div class="flex-grow-1">
                                    <div class="fw-bold">${ingredient.name}</div>
                                    <div class="small text-muted">${ingredient.pinyin} • ${ingredient.category}</div>
                                </div>
                                <button class="btn btn-sm btn-outline-danger remove-ingredient-btn" data-id="${ingredient.id}">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        `;
                    }
                });
                
                listElement.innerHTML = html;
                
                // 绑定移除按钮事件
                document.querySelectorAll('.remove-ingredient-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        const ingredientId = parseInt(btn.getAttribute('data-id'));
                        this.toggleIngredient(ingredientId);
                    });
                });
            },
            
            // 开始学生练习
            startStudentExercise: function() {
                if (this.studentState.selectedIngredients.length === 0) {
                    alert('请至少选择一种原料');
                    return;
                }
                
                // 生成练习题
                this.generateExercise();
                
                // 记录开始时间
                this.studentState.startTime = new Date();
                
                // 切换到练习视图
                this.showView('studentExercise');
                
                // 模拟向服务器报告开始练习
                this.sendToServer('studentStartExercise', {
                    roomCode: this.roomCode,
                    studentName: this.userName,
                    ingredients: this.studentState.selectedIngredients
                });
            },
            
            // 生成练习题
            generateExercise: function() {
                // 根据选择的原料生成练习题
                const selectedIngredientNames = this.studentState.selectedIngredients.map(id => {
                    const ingredient = this.ingredients.find(i => i.id === id);
                    return ingredient ? ingredient.name : '';
                });
                
                // 创建练习对象
                this.studentState.currentExercise = {
                    ingredients: selectedIngredientNames,
                    questions: [],
                    totalQuestions: 0,
                    currentQuestionIndex: 0
                };
                
                // 为每种原料生成2道题
                selectedIngredientNames.forEach(ingredient => {
                    // 随机选择两种题型
                    const template1 = this.exerciseTemplates[0];
                    const template2 = this.exerciseTemplates[Math.floor(Math.random() * (this.exerciseTemplates.length - 1)) + 1];
                    
                    // 生成题目
                    const question1 = {
                        ...template1.questions[0],
                        text: template1.questions[0].text.replace('__', ingredient),
                        correctAnswer: ingredient
                    };
                    
                    const question2 = {
                        ...template2.questions[0],
                        text: template2.questions[0].text.replace('__', ingredient),
                        correctAnswer: ingredient
                    };
                    
                    this.studentState.currentExercise.questions.push(question1, question2);
                });
                
                this.studentState.currentExercise.totalQuestions = this.studentState.currentExercise.questions.length;
                this.studentState.currentQuestionIndex = 0;
                
                // 初始化答案对象
                this.studentState.answers = {};
                this.studentState.score = 0;
                
                // 显示第一题
                this.displayQuestion(0);
            },
            
            // 显示题目
            displayQuestion: function(index) {
                if (!this.studentState.currentExercise || index < 0 || index >= this.studentState.currentExercise.questions.length) {
                    return;
                }
                
                const question = this.studentState.currentExercise.questions[index];
                const container = document.getElementById('exerciseContainer');
                
                // 更新计数器
                document.getElementById('questionCounter').textContent = `题目 ${index + 1}/${this.studentState.currentExercise.totalQuestions}`;
                
                // 更新进度条
                const progressPercent = ((index) / this.studentState.currentExercise.totalQuestions) * 100;
                document.getElementById('exerciseProgress').style.width = `${progressPercent}%`;
                document.getElementById('progressBar').style.width = `${progressPercent}%`;
                document.getElementById('progressPercent').textContent = `${Math.round(progressPercent)}%`;
                
                // 生成选项
                let optionsHtml = '';
                question.options.forEach((option, i) => {
                    const isSelected = this.studentState.answers[index] === option;
                    const isCorrect = question.correctAnswer === option;
                    
                    let optionClass = 'question-option';
                    if (isSelected) {
                        optionClass += ' selected';
                        if (this.studentState.currentExercise.questions[index].answered) {
                            optionClass += isCorrect ? ' correct' : ' incorrect';
                        }
                    }
                    
                    optionsHtml += `
                        <div class="${optionClass}" data-option="${option}">
                            <div class="d-flex align-items-center">
                                <div class="me-3">
                                    <div class="border rounded-circle d-flex align-items-center justify-content-center" style="width: 24px; height: 24px;">
                                        ${String.fromCharCode(65 + i)}
                                    </div>
                                </div>
                                <div class="flex-grow-1">
                                    ${option}
                                </div>
                                ${isSelected && this.studentState.currentExercise.questions[index].answered ? `
                                    <div>
                                        ${isCorrect ? 
                                            '<i class="fas fa-check text-success"></i>' : 
                                            '<i class="fas fa-times text-danger"></i>'
                                        }
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `;
                });
                
                // 构建题目HTML
                container.innerHTML = `
                    <div class="question-card p-4">
                        <h4 class="mb-4">第 ${index + 1} 题</h4>
                        <div class="mb-4">
                            <div class="p-3 bg-light rounded-3 mb-3">
                                <h5 class="text-primary">把字句填空</h5>
                                <p class="lead mb-0">${question.text}</p>
                            </div>
                            <p class="text-muted">
                                <i class="fas fa-lightbulb me-1"></i>
                                提示: ${question.hint}
                            </p>
                        </div>
                        
                        <div class="mb-4">
                            <h6 class="mb-3">选择正确的词填入空格:</h6>
                            <div id="optionsContainer">
                                ${optionsHtml}
                            </div>
                        </div>
                        
                        <div id="questionFeedback" class="mt-3"></div>
                    </div>
                `;
                
                // 绑定选项点击事件
                document.querySelectorAll('.question-option').forEach(option => {
                    option.addEventListener('click', () => {
                        if (!this.studentState.currentExercise.questions[index].answered) {
                            this.selectAnswer(index, option.getAttribute('data-option'));
                        }
                    });
                });
                
                // 更新按钮状态
                const prevBtn = document.getElementById('btnPrevQuestion');
                const nextBtn = document.getElementById('btnNextQuestion');
                
                prevBtn.classList.toggle('d-none', index === 0);
                nextBtn.textContent = index === this.studentState.currentExercise.totalQuestions - 1 ? '完成练习' : '下一题';
                
                // 更新已选原料显示
                this.updateExerciseIngredients();
                
                // 更新得分显示
                this.updateScoreDisplay();
            },
            
            // 选择答案
            selectAnswer: function(questionIndex, answer) {
                const question = this.studentState.currentExercise.questions[questionIndex];
                
                // 记录答案
                this.studentState.answers[questionIndex] = answer;
                question.answered = true;
                
                // 检查是否正确
                const isCorrect = answer === question.correctAnswer;
                if (isCorrect) {
                    this.studentState.score += 10;
                    this.showQuestionFeedback('correct', '太棒了！答案正确。');
                } else {
                    this.showQuestionFeedback('incorrect', `正确答案是: ${question.correctAnswer}`);
                }
                
                // 更新UI
                this.displayQuestion(questionIndex);
                
                // 模拟向服务器报告答案
                this.sendToServer('studentAnswer', {
                    roomCode: this.roomCode,
                    studentName: this.userName,
                    questionIndex: questionIndex,
                    isCorrect: isCorrect,
                    score: this.studentState.score
                });
                
                // 如果是最后一题且已回答，显示完成按钮
                if (questionIndex === this.studentState.currentExercise.totalQuestions - 1) {
                    setTimeout(() => {
                        this.completeExercise();
                    }, 1500);
                }
            },
            
            // 显示题目反馈
            showQuestionFeedback: function(type, message) {
                const container = document.getElementById('questionFeedback');
                const icon = type === 'correct' ? 'fa-check-circle' : 'fa-times-circle';
                const colorClass = type === 'correct' ? 'text-success' : 'text-danger';
                
                container.innerHTML = `
                    <div class="alert alert-${type === 'correct' ? 'success' : 'danger'}">
                        <i class="fas ${icon} me-2 ${colorClass}"></i>
                        ${message}
                    </div>
                `;
            },
            
            // 下一题
            nextQuestion: function() {
                const currentIndex = this.studentState.currentQuestionIndex;
                
                if (currentIndex < this.studentState.currentExercise.totalQuestions - 1) {
                    this.studentState.currentQuestionIndex++;
                    this.displayQuestion(this.studentState.currentQuestionIndex);
                } else {
                    this.completeExercise();
                }
            },
            
            // 上一题
            prevQuestion: function() {
                if (this.studentState.currentQuestionIndex > 0) {
                    this.studentState.currentQuestionIndex--;
                    this.displayQuestion(this.studentState.currentQuestionIndex);
                }
            },
            
            // 完成练习
            completeExercise: function() {
                this.studentState.completed = true;
                
                // 计算用时
                const endTime = new Date();
                const timeSpent = Math.round((endTime - this.studentState.startTime) / 1000);
                
                // 更新最终得分
                const finalScore = this.studentState.score;
                const totalPossible = this.studentState.currentExercise.totalQuestions * 10;
                
                document.getElementById('finalScore').textContent = finalScore;
                document.getElementById('finalTotal').textContent = totalPossible;
                document.getElementById('summaryCorrect').textContent = `${finalScore / 10}/${this.studentState.currentExercise.totalQuestions}`;
                document.getElementById('summaryTime').textContent = timeSpent;
                
                // 设置完成消息
                const titleElement = document.getElementById('completionTitle');
                const messageElement = document.getElementById('completionMessage');
                
                const percentage = (finalScore / totalPossible) * 100;
                
                if (percentage >= 80) {
                    titleElement.innerHTML = '<i class="fas fa-trophy me-2"></i>优秀！';
                    titleElement.className = 'mb-3 text-success';
                    messageElement.textContent = `你成功掌握了位移"把字句"的用法，得分 ${finalScore}/${totalPossible}！`;
                } else if (percentage >= 60) {
                    titleElement.innerHTML = '<i class="fas fa-thumbs-up me-2"></i>很好！';
                    titleElement.className = 'mb-3 text-primary';
                    messageElement.textContent = `你基本掌握了位移"把字句"的用法，得分 ${finalScore}/${totalPossible}，可以再练习一下。`;
                } else {
                    titleElement.innerHTML = '<i class="fas fa-redo me-2"></i>继续努力';
                    titleElement.className = 'mb-3 text-warning';
                    messageElement.textContent = `位移"把字句"还需要更多练习，得分 ${finalScore}/${totalPossible}，请复习错题。`;
                }
                
                // 切换到完成视图
                this.showView('studentComplete');
                
                // 模拟向服务器报告完成
                this.sendToServer('studentCompleteExercise', {
                    roomCode: this.roomCode,
                    studentName: this.userName,
                    score: finalScore,
                    totalQuestions: this.studentState.currentExercise.totalQuestions,
                    timeSpent: timeSpent
                });
            },
            
            // 初始化练习
            initExercise: function() {
                this.displayQuestion(this.studentState.currentQuestionIndex);
                this.updateExerciseIngredients();
                this.updateScoreDisplay();
            },
            
            // 更新练习中的原料显示
            updateExerciseIngredients: function() {
                const container = document.getElementById('exerciseIngredients');
                if (this.studentState.currentExercise && this.studentState.currentExercise.ingredients) {
                    container.innerHTML = this.studentState.currentExercise.ingredients
                        .map(ing => `<span class="badge bg-warning me-1 mb-1">${ing}</span>`)
                        .join('');
                }
            },
            
            // 更新得分显示
            updateScoreDisplay: function() {
                document.getElementById('currentScore').textContent = this.studentState.score;
                
                if (this.studentState.currentExercise) {
                    const total = this.studentState.currentExercise.totalQuestions * 10;
                    document.getElementById('totalScore').textContent = total;
                }
            },
            
            // 复习错题
            reviewExercise: function() {
                // 找出错题
                const wrongQuestions = [];
                this.studentState.currentExercise.questions.forEach((question, index) => {
                    if (this.studentState.answers[index] !== question.correctAnswer) {
                        wrongQuestions.push({ ...question, originalIndex: index });
                    }
                });
                
                if (wrongQuestions.length === 0) {
                    alert('没有错题需要复习！');
                    return;
                }
                
                // 创建复习练习
                this.studentState.currentExercise = {
                    ingredients: this.studentState.currentExercise.ingredients,
                    questions: wrongQuestions,
                    totalQuestions: wrongQuestions.length,
                    isReview: true
                };
                
                this.studentState.currentQuestionIndex = 0;
                this.studentState.answers = {};
                this.studentState.score = 0;
                
                // 切换到练习视图
                this.showView('studentExercise');
            },
            
            // 选择新原料
            newIngredients: function() {
                this.studentState.selectedIngredients = [];
                this.studentState.currentExercise = null;
                this.studentState.currentQuestionIndex = 0;
                this.studentState.answers = {};
                this.studentState.score = 0;
                this.studentState.completed = false;
                
                this.showView('studentIngredients');
            },
            
            // 显示反馈消息
            showFeedback: function(type, message) {
                const container = document.getElementById('feedbackArea');
                const alertClass = type === 'success' ? 'alert-success' : 'alert-info';
                const icon = type === 'success' ? 'fa-check-circle' : 'fa-info-circle';
                
                container.innerHTML = `
                    <div class="alert ${alertClass}">
                        <i class="fas ${icon} me-2"></i>
                        ${message}
                    </div>
                `;
                
                // 5秒后自动消失
                setTimeout(() => {
                    container.innerHTML = '';
                }, 5000);
            },
            
            // 模拟发送到服务器
            sendToServer: function(event, data) {
                console.log(`[模拟WebSocket] 发送事件: ${event}`, data);
                
                // 在实际应用中，这里会通过WebSocket发送数据到服务器
                // this.socket.emit(event, data);
            }
        };
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', () => {
            AppState.init();
        });
    </script>
</body>
</html>